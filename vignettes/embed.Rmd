---
title: "ANSI CSI SGR Text in Vignettes"
author: "Brodie Gaslam"
output:
    rmarkdown::html_vignette:
        toc: true
        css: styles.css
vignette: >
  %\VignetteIndexEntry{Embed Diffs in R Markdown}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r echo=FALSE}
library(fansi)
```

## Introduction

Over the past few years color has been gaining traction in the R terminal.  
Gábor Csárdi's [crayon]() made it easy to format text with [ANSI CSI SGR
sequences]().  Unfortunately these sequences are not recognized by web browser,
and instead end up rendering weirdly, as in this example:

```{r}
cat("\033[42mday > night\033[0m")  # this should output in green
```
Instead of the expected:

```{r echo=FALSE, child='chunks/knit-hook.Rmd'}
```
```{r echo=FALSE, fansi=TRUE, results='asis'}
cat("\033[42mday > night\033[0m")
```

## Output as HTML

Among other things `fansi` provides the `sgr_to_html` function which converts
the ANSI CSI SGR sequences into HTML markup:

```{r}
fansi::sgr_to_html("\033[42mday > night\n\033[0m")
```

This however is insufficient as `knitr` / `rmarkdown` will escape all the HTML
markup so the browser does not interpret it:

```{r}
cat(fansi::sgr_to_html("\033[42mday > night\033[0m"))
```

## Knitr Integration

`knitr` allows us to set hooks that process the output of evaluated R code
chunks:

```{r eval=FALSE}
knitr::knit_hooks$set(output = FUN)
```

`FUN` is a function that takes the raw screen output (captured as text) produced
by the R code chunk and modifies it for display in the Styling

## Styling

